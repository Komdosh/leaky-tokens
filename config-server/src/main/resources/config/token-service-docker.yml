spring:
  kafka:
    bootstrap-servers: kafka:9092

  data:
    redis:
      host: redis
      port: 6379

  security:
    oauth2:
      resourceserver:
        jwt:
          jwk-set-uri: http://auth-server:8081/oauth2/jwks

  flyway:
    enabled: true
    locations: classpath:db/migration
    baseline-on-migrate: true

token:
  bucket:
    store: redis
    entry-ttl: 6h
    cleanup-interval: 30m
  quota:
    enabled: true
    window: 24h
  tiers:
    default-tier: USER
    levels:
      USER:
        priority: 10
        bucket-capacity-multiplier: 1.0
        bucket-leak-rate-multiplier: 1.0
        quota-max-tokens: 100000
      ADMIN:
        priority: 100
        bucket-capacity-multiplier: 2.0
        bucket-leak-rate-multiplier: 2.0
        quota-max-tokens: 500000

feature:
  flags:
    token-service:
      quota-enforcement: true
      saga-purchases: true

providers:
  qwen:
    base-url: http://qwen-stub:8091
  gemini:
    base-url: http://gemini-stub:8092
  openai:
    base-url: http://openai-stub:8093

resilience4j:
  circuitbreaker:
    instances:
      providerCalls:
        slidingWindowSize: 20
        minimumNumberOfCalls: 10
        failureRateThreshold: 50
        waitDurationInOpenState: 10s
  retry:
    instances:
      providerCalls:
        maxAttempts: 3
        waitDuration: 250ms
        retryExceptions:
          - java.io.IOException
          - org.springframework.web.reactive.function.client.WebClientRequestException
          - org.springframework.web.reactive.function.client.WebClientResponseException
  bulkhead:
    instances:
      providerCalls:
        maxConcurrentCalls: 20
        maxWaitDuration: 0
  timelimiter:
    instances:
      providerCalls:
        timeoutDuration: 2s
        cancelRunningFuture: true
